{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://todo-chatbot.example.com/schemas/task-event/v1.0.json",
  "title": "TaskEvent",
  "description": "Event published when a task is created, updated, completed, or deleted",
  "type": "object",
  "required": [
    "schema_version",
    "event_type",
    "task_id",
    "user_id",
    "timestamp",
    "correlation_id",
    "task_snapshot"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "enum": ["1.0"],
      "description": "Schema version for backward compatibility"
    },
    "event_type": {
      "type": "string",
      "enum": ["created", "updated", "completed", "deleted"],
      "description": "Type of task event"
    },
    "task_id": {
      "type": "integer",
      "minimum": 1,
      "description": "Unique task identifier"
    },
    "user_id": {
      "type": "string",
      "format": "uuid",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
      "description": "User who owns the task"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Event timestamp in ISO 8601 UTC format"
    },
    "correlation_id": {
      "type": "string",
      "format": "uuid",
      "description": "Correlation ID for distributed tracing"
    },
    "task_snapshot": {
      "type": "object",
      "description": "Complete task state at time of event",
      "required": ["id", "title", "status", "priority"],
      "properties": {
        "id": {
          "type": "integer"
        },
        "user_id": {
          "type": "string",
          "format": "uuid"
        },
        "title": {
          "type": "string",
          "maxLength": 200
        },
        "description": {
          "type": ["string", "null"],
          "maxLength": 2000
        },
        "status": {
          "type": "string",
          "enum": ["todo", "in_progress", "completed"]
        },
        "priority": {
          "type": "string",
          "enum": ["high", "medium", "low"]
        },
        "due_at": {
          "type": ["string", "null"],
          "format": "date-time"
        },
        "completed_at": {
          "type": ["string", "null"],
          "format": "date-time"
        },
        "recurrence_pattern_id": {
          "type": ["integer", "null"]
        },
        "parent_task_id": {
          "type": ["integer", "null"]
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time"
        }
      }
    }
  },
  "examples": [
    {
      "schema_version": "1.0",
      "event_type": "created",
      "task_id": 1001,
      "user_id": "550e8400-e29b-41d4-a716-446655440000",
      "timestamp": "2026-01-05T10:00:00.123Z",
      "correlation_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "task_snapshot": {
        "id": 1001,
        "user_id": "550e8400-e29b-41d4-a716-446655440000",
        "title": "Buy groceries",
        "description": "Milk, eggs, bread",
        "status": "todo",
        "priority": "medium",
        "due_at": null,
        "completed_at": null,
        "recurrence_pattern_id": null,
        "parent_task_id": null,
        "tags": ["shopping"],
        "created_at": "2026-01-05T10:00:00Z",
        "updated_at": "2026-01-05T10:00:00Z"
      }
    },
    {
      "schema_version": "1.0",
      "event_type": "completed",
      "task_id": 1002,
      "user_id": "550e8400-e29b-41d4-a716-446655440000",
      "timestamp": "2026-01-06T10:15:00.456Z",
      "correlation_id": "b2c3d4e5-f6g7-8901-bcde-f12345678901",
      "task_snapshot": {
        "id": 1002,
        "user_id": "550e8400-e29b-41d4-a716-446655440000",
        "title": "Weekly team meeting",
        "description": "Monday standup",
        "status": "completed",
        "priority": "high",
        "due_at": "2026-01-06T10:00:00Z",
        "completed_at": "2026-01-06T10:15:00Z",
        "recurrence_pattern_id": 1,
        "parent_task_id": null,
        "tags": ["work", "meeting"],
        "created_at": "2026-01-01T09:00:00Z",
        "updated_at": "2026-01-06T10:15:00Z"
      }
    }
  ]
}
